{% extends 'base.html' %}

{% block title %}Knapsack Problem - Algorithm Analysis{% endblock %}

{% block content %}
<section class="page-section">
    <div class="container">
        <!-- Page Header -->
        <div class="page-header">
            <div class="header-icon">
                <i class="bi bi-bag-fill"></i>
            </div>
            <h1 class="page-title">Knapsack Problem</h1>
            <p class="page-subtitle">
                Compare <span class="text-greedy">Fractional Knapsack (Greedy)</span> vs 
                <span class="text-dp">0/1 Knapsack (DP)</span>
            </p>
        </div>

        <!-- Error Alert -->
        {% if error %}
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            <i class="bi bi-exclamation-triangle me-2"></i>{{ error }}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        {% endif %}

        <!-- Input Form -->
        <div class="input-card">
            <div class="card-header-custom">
                <i class="bi bi-input-cursor-text me-2"></i>
                Input Data
            </div>
            <form method="POST" class="algorithm-form">
                {% csrf_token %}
                
                <div class="row g-4">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="form-label">
                                <i class="bi bi-box me-1"></i>Weights
                                <span class="hint">(comma-separated)</span>
                            </label>
                            <input type="text" name="weights" class="form-control" 
                                   placeholder="e.g., 10, 20, 30" 
                                   required>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="form-label">
                                <i class="bi bi-currency-dollar me-1"></i>Values
                                <span class="hint">(comma-separated)</span>
                            </label>
                            <input type="text" name="values" class="form-control" 
                                   placeholder="e.g., 60, 100, 120"
                                   required>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="form-label">
                                <i class="bi bi-bag me-1"></i>Knapsack Capacity
                            </label>
                            <input type="number" name="capacity" class="form-control" 
                                   placeholder="e.g., 50"
                                   required min="1">
                        </div>
                    </div>
                    
                    <div class="col-md-6 d-flex align-items-end">
                        <button type="submit" class="btn btn-primary btn-compare w-100">
                            <i class="bi bi-play-circle me-2"></i>Compare Algorithms
                        </button>
                    </div>
                </div>
                
                <!-- Quick Examples -->
                <div class="quick-examples mt-4">
                    <span class="example-label">Quick Examples:</span>
                    <button type="button" class="btn btn-outline-secondary btn-sm example-btn" 
                            data-weights="10, 20, 30" data-values="60, 100, 120" data-capacity="50">
                        Example 1
                    </button>
                    <button type="button" class="btn btn-outline-secondary btn-sm example-btn" 
                            data-weights="1, 2, 3, 5" data-values="10, 15, 40, 50" data-capacity="6">
                        Example 2
                    </button>
                    <button type="button" class="btn btn-outline-secondary btn-sm example-btn"
                            data-weights="5, 10, 15, 22, 25" data-values="30, 40, 45, 77, 90" data-capacity="60">
                        Example 3
                    </button>
                    <button type="button" class="btn btn-outline-secondary btn-sm example-btn"
                            data-weights="2, 3, 4, 5" data-values="3, 4, 5, 6" data-capacity="8">
                        Example 4
                    </button>
                    <button type="button" class="btn btn-outline-secondary btn-sm example-btn"
                            data-weights="1, 3, 4, 5, 2" data-values="1, 4, 5, 7, 3" data-capacity="9">
                        Example 5
                    </button>
                </div>
            </form>
        </div>

        {% if show_results %}
        <!-- Results Section -->
        <div class="results-section">
            <!-- Input Summary -->
            <div class="input-summary">
                <h5><i class="bi bi-info-circle me-2"></i>Input Summary</h5>
                <div class="summary-grid">
                    <div class="summary-item">
                        <span class="label">Items</span>
                        <span class="value">{{ input_data.num_items }}</span>
                    </div>
                    <div class="summary-item">
                        <span class="label">Capacity</span>
                        <span class="value">{{ input_data.capacity }}</span>
                    </div>
                </div>
                
                <!-- Input Values Table -->
                <div class="input-values-table mt-3">
                    <h6><i class="bi bi-table me-2"></i>Input Items</h6>
                    <div class="table-responsive">
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>Item</th>
                                    {% for w in input_data.weights %}
                                    <th class="text-center">#{{ forloop.counter }}</th>
                                    {% endfor %}
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>Weight</strong></td>
                                    {% for w in input_data.weights %}
                                    <td class="text-center">{{ w }}</td>
                                    {% endfor %}
                                </tr>
                                <tr>
                                    <td><strong>Value</strong></td>
                                    {% for v in input_data.values %}
                                    <td class="text-center text-success">{{ v }}</td>
                                    {% endfor %}
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Comparison Table -->
            <div class="comparison-card">
                <div class="card-header-custom">
                    <i class="bi bi-bar-chart me-2"></i>
                    Algorithm Comparison
                </div>
                <div class="table-responsive">
                    <table class="table comparison-table">
                        <thead>
                            <tr>
                                <th>Metric</th>
                                <th class="text-greedy">Fractional (Greedy)</th>
                                <th class="text-dp">0/1 (DP)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><i class="bi bi-cash-coin me-2"></i>Maximum Value</td>
                                <td class="value-cell greedy">{{ greedy_result.max_value }}</td>
                                <td class="value-cell dp">{{ dp_result.max_value }}</td>
                            </tr>
                            <tr>
                                <td><i class="bi bi-stopwatch me-2"></i>Execution Time</td>
                                <td>{{ greedy_result.execution_time }} ms</td>
                                <td>{{ dp_result.execution_time }} ms</td>
                            </tr>
                            <tr>
                                <td><i class="bi bi-clock-history me-2"></i>Time Complexity</td>
                                <td>{{ greedy_result.time_complexity }}</td>
                                <td>{{ dp_result.time_complexity }}</td>
                            </tr>
                            <tr>
                                <td><i class="bi bi-pie-chart me-2"></i>Allows Fractions</td>
                                <td><span class="badge bg-success">Yes</span></td>
                                <td><span class="badge bg-danger">No</span></td>
                            </tr>
                            <tr>
                                <td><i class="bi bi-graph-up me-2"></i>Value Difference</td>
                                <td colspan="2" class="text-center">
                                    <strong>{{ comparison.value_difference }}</strong>
                                    <span class="text-muted">(Greedy - DP)</span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Detailed Results -->
            <div class="row g-4">
                <!-- Greedy Result -->
                <div class="col-lg-6">
                    <div class="result-card greedy-result">
                        <div class="result-header">
                            <i class="bi bi-lightning-charge"></i>
                            <h4>Fractional Knapsack (Greedy)</h4>
                        </div>
                        <div class="result-value">
                            <span class="label">Total Value</span>
                            <span class="value">{{ greedy_result.max_value }}</span>
                        </div>
                        <div class="selected-items">
                            <h6><i class="bi bi-list-check me-2"></i>Selected Items</h6>
                            <div class="table-responsive">
                                <table class="table table-sm">
                                    <thead>
                                        <tr>
                                            <th>Item</th>
                                            <th>Weight</th>
                                            <th>Value</th>
                                            <th>Fraction</th>
                                            <th>Contributed</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for item in greedy_result.selected_items %}
                                        <tr>
                                            <td>#{{ item.item_index }}</td>
                                            <td>{{ item.weight }}</td>
                                            <td>{{ item.value }}</td>
                                            <td>{{ item.fraction }}</td>
                                            <td class="text-success">{{ item.value_contributed }}</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- DP Result -->
                <div class="col-lg-6">
                    <div class="result-card dp-result">
                        <div class="result-header">
                            <i class="bi bi-table"></i>
                            <h4>0/1 Knapsack (DP)</h4>
                        </div>
                        <div class="result-value">
                            <span class="label">Total Value</span>
                            <span class="value">{{ dp_result.max_value }}</span>
                        </div>
                        <div class="selected-items">
                            <h6><i class="bi bi-list-check me-2"></i>Selected Items</h6>
                            <div class="table-responsive">
                                <table class="table table-sm">
                                    <thead>
                                        <tr>
                                            <th>Item</th>
                                            <th>Weight</th>
                                            <th>Value</th>
                                            <th>Contributed</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for item in dp_result.selected_items %}
                                        <tr>
                                            <td>#{{ item.item_index }}</td>
                                            <td>{{ item.weight }}</td>
                                            <td>{{ item.value }}</td>
                                            <td class="text-success">{{ item.value_contributed }}</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Analysis Section -->
            <div class="analysis-card">
                <div class="card-header-custom">
                    <i class="bi bi-lightbulb me-2"></i>
                    Analysis & Insights
                </div>
                <div class="analysis-content">
                    <div class="insight">
                        <i class="bi bi-arrow-right-circle text-greedy"></i>
                        <p>
                            <strong>Greedy (Fractional):</strong> 
                            Achieved value of <strong>{{ greedy_result.max_value }}</strong> by taking 
                            fractions of items based on value-to-weight ratio.
                        </p>
                    </div>
                    <div class="insight">
                        <i class="bi bi-arrow-right-circle text-dp"></i>
                        <p>
                            <strong>Dynamic Programming (0/1):</strong> 
                            Achieved value of <strong>{{ dp_result.max_value }}</strong> by considering 
                            all possible combinations without fractions.
                        </p>
                    </div>
                    {% if comparison.value_difference > 0 %}
                    <div class="insight highlight">
                        <i class="bi bi-info-circle"></i>
                        <p>
                            The Greedy solution provides a <strong>higher value</strong> because it can 
                            take fractional parts of items. However, in real-world scenarios where items 
                            cannot be divided, the DP solution gives the <strong>optimal discrete answer</strong>.
                        </p>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</section>

{% block extra_js %}
<script>
    // Quick example buttons
    document.querySelectorAll('.example-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            document.querySelector('input[name="weights"]').value = this.dataset.weights;
            document.querySelector('input[name="values"]').value = this.dataset.values;
            document.querySelector('input[name="capacity"]').value = this.dataset.capacity;
        });
    });
</script>
{% endblock %}
{% endblock %}
